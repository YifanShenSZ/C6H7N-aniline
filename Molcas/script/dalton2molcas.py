'''
convert dalton mocoef to molcas
'''

import argparse
from pathlib import Path
from typing import List
from collections import deque

from DaltonNitrogenAO import DaltonNitrogenAO
from DaltonCarbonAO import DaltonCarbonAO
from DaltonHydrogenAO import DaltonHydrogenAO

def parse_args() -> argparse.Namespace: # Command line input
    parser = argparse.ArgumentParser(__doc__)
    parser.add_argument("input", type=Path, help="input dalton mocoef")
    parser.add_argument("-o","--output", default=Path("mocoef"), help="output molcas mocoef (default = mocoef)")
    args = parser.parse_args()
    return args

# given the coefficient lines, parse them into a vector
def parse_mo(lines : List[str]) -> deque:
    coeffs = deque()
    for line in lines:
        for str in line.split():
            coeffs.append(float(str.replace('D', 'e')))
    return coeffs

if __name__ == "__main__":
    args = parse_args()
    with open(args.input, 'r') as f: lines = f.readlines()
    with open(args.output, 'w') as f:
        # just some header lines
        for i in range(12):
            print(lines[i], end='', file=f)
        # mo coefficient lines
        for i in range(246):
            coeffs = parse_mo(lines[12 + 82 * i : 12 + 82 * i + 82])
            cursor_position = [0]
            N = DaltonNitrogenAO(coeffs)
            N.print2Molcas(f, cursor_position)
            for i in range(6):
                C = DaltonCarbonAO(coeffs)
                C.print2Molcas(f, cursor_position)
            for i in range(7):
                H = DaltonHydrogenAO(coeffs)
                H.print2Molcas(f, cursor_position)
            # since 246 % 3 == 0, there is no need to print an additional '\n'
        # just some tail lines
        print('''orbocc
(1p3d25.15)                             
    2.000000000000000D+00    2.000000000000000D+00    2.000000000000000D+00
    2.000000000000000D+00    2.000000000000000D+00    2.000000000000000D+00
    2.000000000000000D+00    2.000000000000000D+00    2.000000000000000D+00
    2.000000000000000D+00    2.000000000000000D+00    2.000000000000000D+00
    2.000000000000000D+00    2.000000000000000D+00    2.000000000000000D+00
    2.000000000000000D+00    2.000000000000000D+00    2.000000000000000D+00
    1.000000000000000D+00    1.000000000000000D+00    1.000000000000000D+00
    1.000000000000000D+00    1.000000000000000D+00    1.000000000000000D+00
    1.000000000000000D+00    1.000000000000000D+00    1.000000000000000D+00
    1.000000000000000D+00    1.000000000000000D+00    1.000000000000000D+00
    1.000000000000000D+00    1.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00
    0.000000000000000D+00    0.000000000000000D+00    0.000000000000000D+00''', file=f)
